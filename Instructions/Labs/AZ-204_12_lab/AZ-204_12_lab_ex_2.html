<article>
<h4><a id="user-content-task-1-build-a-net-web-api-project" class="anchor" aria-hidden="true" href="#task-1-build-a-net-web-api-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Build a .NET Web API project</h4>
<ol>
<li>
<p>Open Visual Studio Code.</p>
</li>
<li>
<p>In Visual Studio Code, open the <strong>Allfiles (F):\Allfiles\Labs\12\Starter\Api</strong> folder.</p>
</li>
<li>
<p>Use the Explorer pane in Visual Studio Code to open a new terminal that has the context set to the current working directory.</p>
</li>
<li>
<p>At the command prompt, create a new .NET Web API application named <strong>SimpleApi</strong> in the current directory:</p>
<pre><code>dotnet new webapi --output . --name SimpleApi
</code></pre>
</li>
<li>
<p>Import version 2.14.0 of <strong>Microsoft.ApplicationInsights</strong> from NuGet to the current project:</p>
<pre><code>dotnet add package Microsoft.ApplicationInsights --version 2.14.0
</code></pre>
<blockquote>
<p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.ApplicationInsights</strong> package from NuGet. For more information, go to <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights/2.14.0" rel="nofollow">Microsoft.ApplicationInsights</a>.</p>
</blockquote>
</li>
<li>
<p>Import version 2.14.0 of <strong>Microsoft.ApplicationInsights.AspNetCore</strong> from NuGet to the current project:</p>
<pre><code>dotnet add package Microsoft.ApplicationInsights.AspNetCore --version 2.14.0
</code></pre>
<blockquote>
<p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.ApplicationInsights.AspNetCore</strong> package from NuGet. For more information, go to <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.AspNetCore/2.14.0" rel="nofollow">Microsoft.ApplicationInsights.AspNetCore</a>.</p>
</blockquote>
</li>
<li>
<p>Import version 2.14.0 of <strong>Microsoft.ApplicationInsights.PerfCounterCollector</strong> from NuGet to the current project:</p>
<pre><code>dotnet add package Microsoft.ApplicationInsights.PerfCounterCollector  --version 2.14.0
</code></pre>
<blockquote>
<p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.ApplicationInsights.PerfCounterCollector</strong> package from NuGet. For more information, go to <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.PerfCounterCollector/2.14.0" rel="nofollow">Microsoft.ApplicationInsights.PerfCounterCollector</a>.</p>
</blockquote>
</li>
<li>
<p>Build the .NET web app:</p>
<pre><code>dotnet build
</code></pre>
</li>
</ol>
<h4><a id="user-content-task-2-update-application-code-to-disable-https-and-use-application-insights" class="anchor" aria-hidden="true" href="#task-2-update-application-code-to-disable-https-and-use-application-insights"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Update application code to disable HTTPS and use Application Insights</h4>
<ol>
<li>
<p>Use the Explorer in Visual Studio Code to open the <strong>Startup.cs</strong> file in the editor.</p>
</li>
<li>
<p>Find and delete the following line of code at line 39:</p>
<pre><code>app.UseHttpsRedirection();
</code></pre>
<blockquote>
<p><strong>Note</strong>: This line of code forces the web app to use HTTPS. For this lab, this is unnecessary.</p>
</blockquote>
</li>
<li>
<p>In the <strong>Startup</strong> class, add a new static string constant named <strong>INSTRUMENTATION_KEY</strong> with its value set to the instrumentation key that you copied from the Application Insights resource you created earlier in this lab:</p>
<pre><code>private static string INSTRUMENTATION_KEY = "{your_instrumentation_key}";
</code></pre>
<blockquote>
<p><strong>Note</strong>: For example, if your instrumentation key is <code>d2bb0eed-1342-4394-9b0c-8a56d21aaa43</code>, your line of code would be <code>private static string INSTRUMENTATION_KEY = "d2bb0eed-1342-4394-9b0c-8a56d21aaa43";</code></p>
</blockquote>
</li>
<li>
<p>Add a new line of code in the <strong>ConfigureServices</strong> method to configure Application Insights using the provided instrumentation key:</p>
<pre><code>services.AddApplicationInsightsTelemetry(INSTRUMENTATION_KEY);
</code></pre>
</li>
<li>
<p>Save the <strong>Startup.cs</strong> file.</p>
</li>
<li>
<p>If it's not already open, use the Explorer in Visual Studio Code to open a new terminal with the context set to the current working directory.</p>
</li>
<li>
<p>Build the .NET web app:</p>
<pre><code>dotnet build
</code></pre>
</li>
</ol>
<h4><a id="user-content-task-3-test-an-api-application-locally" class="anchor" aria-hidden="true" href="#task-3-test-an-api-application-locally"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Test an API application locally</h4>
<ol>
<li>
<p>If it's not already open, use the Explorer in Visual Studio Code to open a new terminal with the context set to the current working directory.</p>
</li>
<li>
<p>Run the .NET web app.</p>
<pre><code>dotnet run
</code></pre>
</li>
<li>
<p>Open a new <strong>Microsoft Edge</strong> browser window.</p>
</li>
<li>
<p>In the open browser window, go to the <strong>/weatherforecast</strong> relative path of your test application that's hosted at <strong>localhost</strong> on port <strong>5000</strong>.</p>
<blockquote>
<p><strong>Note</strong>: The full URL is <a href="http://localhost:5000/weatherforecast" rel="nofollow">http://localhost:5000/weatherforecast</a>.</p>
</blockquote>
</li>
<li>
<p>Close the browser window that you recently opened.</p>
</li>
<li>
<p>Close the currently running Visual Studio Code application.</p>
</li>
</ol>
<h4><a id="user-content-task-4-get-metrics-in-application-insights" class="anchor" aria-hidden="true" href="#task-4-get-metrics-in-application-insights"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Get metrics in Application Insights</h4>
<ol>
<li>
<p>Return to your currently open browser window that's displaying the Azure portal.</p>
</li>
<li>
<p>Access the <em><em>instrm</em>[yourname]</em>** Application Insights account that you created earlier in this lab.</p>
</li>
<li>
<p>From the <strong>Application Insights</strong> blade, find the metrics displayed in the tiles in the center of the blade. Specifically, find the number of server requests that have occurred and the average server response time.</p>
<blockquote>
<p><strong>Note</strong>: It can take up to five minutes to observe requests in the Application Insights metrics charts.</p>
</blockquote>
</li>
</ol>
<h4><a id="user-content-review-1" class="anchor" aria-hidden="true" href="#review-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Review</h4>
<p>In this exercise, you created an API by using ASP.NET and configured it to stream application metrics to Application Insights. You then used the Application Insights dashboard to get performance details about your API.</p>
</article>