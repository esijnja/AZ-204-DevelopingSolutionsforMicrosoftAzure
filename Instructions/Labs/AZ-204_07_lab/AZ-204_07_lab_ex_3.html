<article>
  <h4><a id="user-content-task-1-initialize-a-function-project" class="anchor" aria-hidden="true" href="#task-1-initialize-a-function-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Initialize a function project</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> empty directory:</p>
  <div class="highlight highlight-source-powershell"><pre>cd F:\Allfiles\Labs\<span class="pl-c1">07</span>\Starter\func</pre></div>
  </li>
  <li>
  <p>Use the <strong>Azure Functions Core Tools</strong> to create a new local Azure Functions project with the following details:</p>
  <ul>
  <li>worker runtime: <strong>dotnet</strong></li>
  </ul>
  <div class="highlight highlight-source-powershell"><pre>func init <span class="pl-k">--</span>worker<span class="pl-k">-</span>runtime dotnet</pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [create a new project][azure-functions-core-tools-new-project] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p><strong>Build</strong> the .NET Core 3.1 project:</p>
  <div class="highlight highlight-source-powershell"><pre>dotnet build</pre></div>
  </li>
  </ol>
  <h4><a id="user-content-task-2-create-an-http-triggered-function" class="anchor" aria-hidden="true" href="#task-2-create-an-http-triggered-function"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Create an HTTP-triggered function</h4>
  <ol>
  <li>
  <p>Still in the open command prompt,create a new function with the following details:</p>
  <ul>
  <li>template: <strong>HTTP trigger</strong></li>
  <li>name: <strong>FileParser</strong></li>
  </ul>
  <div class="highlight highlight-source-powershell"><pre>func new <span class="pl-k">--</span>template <span class="pl-s"><span class="pl-pds">"</span>HTTP trigger<span class="pl-pds">"</span></span> <span class="pl-k">--</span>name <span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [create a new function][azure-functions-core-tools-new-function] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-3-configure-and-read-an-application-setting" class="anchor" aria-hidden="true" href="#task-3-configure-and-read-an-application-setting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Configure and read an application setting</h4>
  <ol>
  <li>
  <p>Open <strong>Visual Studio Code</strong>.</p>
  </li>
  <li>
  <p>Using <strong>Visual Studio Code</strong>, open the solution folder found at <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>.</p>
  </li>
  <li>
  <p>Open the <strong>local.settings.json</strong> file.</p>
  </li>
  <li>
  <p>Update the value of the <strong>Values</strong> object by adding a new setting named <strong>StorageConnectionString</strong> and setting it to a string value of <strong>[TEST VALUE]</strong>:</p>
  <div class="highlight highlight-source-json"><pre><span class="pl-s"><span class="pl-pds">"</span>Values<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>AzureWebJobsStorage<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>UseDevelopmentStorage=true<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>FUNCTIONS_WORKER_RUNTIME<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>dotnet<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>[TEST VALUE]<span class="pl-pds">"</span></span>
  }</pre></div>
  </li>
  <li>
  <p>Open the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>In the code editor, delete all the code within the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>Add <strong>using directives</strong> for the <strong>Microsoft.AspNetCore.Mvc</strong>, <strong>Microsoft.Azure.WebJobs</strong>, <strong>Microsoft.AspNetCore.Http</strong>, <strong>System</strong>, and <strong>System.Threading.Tasks</strong> namespaces:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">AspNetCore</span>.<span class="pl-en">Mvc</span>;
  <span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">Azure</span>.<span class="pl-en">WebJobs</span>;
  <span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">AspNetCore</span>.<span class="pl-en">Http</span>;
  <span class="pl-k">using</span> <span class="pl-en">System</span>;
  <span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">Threading</span>.<span class="pl-en">Tasks</span>;</pre></div>
  </li>
  <li>
  <p>Create a new <strong>public static</strong> class named <strong>FileParser</strong>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">FileParser</span>
  { }</pre></div>
  </li>
  <li>
  <p>Within the <strong>FileParser</strong> class, create a new <strong>public static</strong> <em>asynchronous</em> method named <strong>Run</strong> that returns a variable of type <strong>Task&lt;IActionResult&gt;</strong> and that also takes in a variable of type <strong>HttpRequest</strong> named <em>request</em>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Append an attribute to the <strong>Run</strong> method of type <strong>FunctionNameAttribute</strong> that has its <strong>name</strong> parameter set to a value of <strong>FileParser</strong>:</p>
  <div class="highlight highlight-source-cs"><pre>[<span class="pl-en">FunctionName</span>(<span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span>)]
  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Append an attribute to the <strong>request</strong> parameter of type <strong>HttpTriggerAttribute</strong> that has its <strong>methods</strong> parameter array set to a single value of <strong>GET</strong>:</p>
  <div class="highlight highlight-source-cs"><pre>[<span class="pl-en">FunctionName</span>(<span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span>)]
  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      [<span class="pl-en">HttpTrigger</span>(<span class="pl-s"><span class="pl-pds">"</span>GET<span class="pl-pds">"</span></span>)] <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Within the <strong>Run</strong> method, retrieve the value of the <strong>StorageConnectionString</strong> application setting by using the <strong>Environment.GetEnvironmentVariable</strong> method and storing the result in a <strong>string</strong> variable named <strong>connectionString</strong>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">string</span> <span class="pl-smi">connectionString</span> <span class="pl-k">=</span> <span class="pl-smi">Environment</span>.<span class="pl-en">GetEnvironmentVariable</span>(<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>);</pre></div>
  </li>
  <li>
  <p>Finally, return the value of the <strong>connectionString</strong> variable as the HTTP response:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">OkObjectResult</span>(<span class="pl-smi">connectionString</span>);</pre></div>
  </li>
  <li>
  <p><strong>Save</strong> the <strong>Echo.cs</strong> file.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-4-validate-the-local-function" class="anchor" aria-hidden="true" href="#task-4-validate-the-local-function"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Validate the local function</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Start the function app project:</p>
  <div class="highlight highlight-source-powershell"><pre>func start <span class="pl-k">--</span>build</pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [start the function app project locally][azure-functions-core-tools-start-function] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Open a new instance of the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Start the <strong>httprepl</strong> tool, and then set the base Uniform Resource Identifier (URI) to <code>http://localhost:7071</code>:</p>
  <div class="highlight highlight-source-powershell"><pre>httprepl http:<span class="pl-k">//</span>localhost:<span class="pl-c1">7071</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: An error message is displayed by the httprepl tool. This message occurs because the tool is searching for a Swagger definition file to use to "traverse" the API. Because your functio projectp does not produce a Swagger definition file, you'll need to traverse the API manually.</p>
  </blockquote>
  </li>
  <li>
  <p>When you receive the tool prompt, browse to the relative <strong>api/fileparser</strong> directory:</p>
  <div class="highlight highlight-source-powershell"><pre>cd api
  cd fileparser</pre></div>
  </li>
  <li>
  <p>Run the <strong>get</strong> command:</p>
  <div class="highlight highlight-source-powershell"><pre>get</pre></div>
  </li>
  <li>
  <p>Observe the <strong>[TEST VALUE]</strong> value of the <strong>StorageConnectionString</strong> being returned as the result of the HTTP request.</p>
  </li>
  <li>
  <p>Exit the <strong>httprepl</strong> application:</p>
  <div class="highlight highlight-source-powershell"><pre><span class="pl-k">exit</span></pre></div>
  </li>
  <li>
  <p>Close all currently running instances of the <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-5-deploy-using-the-azure-functions-core-tools" class="anchor" aria-hidden="true" href="#task-5-deploy-using-the-azure-functions-core-tools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 5: Deploy using the Azure Functions Core Tools</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Log in to the Azure Command-Line Interface (CLI) by using your Azure credentials:</p>
  <div class="highlight highlight-source-powershell"><pre>az login</pre></div>
  </li>
  <li>
  <p>Publish the function app project:</p>
  <div class="highlight highlight-source-powershell"><pre>func azure functionapp publish <span class="pl-k">&lt;</span>function<span class="pl-k">-</span>app<span class="pl-k">-</span>name<span class="pl-k">&gt;</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: For example, if your <strong>Function App name</strong> is <strong>securefuncstudent</strong>, your command would be <code>func azure functionapp publish securefuncstudent</code>. You can review the documentation to [publish the local function app project][azure-functions-core-tools-publish-azure] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Wait for the deployment to finalize before you move forward with the lab.</p>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-6-test-the-key-vault-derived-application-setting" class="anchor" aria-hidden="true" href="#task-6-test-the-key-vault-derived-application-setting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 6: Test the Key Vault-derived application setting</h4>
  <ol>
  <li>Sign in to the Azure portal (<a href="https://portal.azure.com" rel="nofollow">https://portal.azure.com</a>).</li>
  <li>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</li>
  <li>From the <strong>App Service</strong> blade, locate and open the <strong>Functions</strong> section, and then locate and open the <strong>FileParser</strong> function.</li>
  <li>In the <strong>Function</strong> blade, select the <strong>Code + Test</strong> option from the <strong>Developer</strong> section.</li>
  <li>In the function editor, select <strong>Test/Run</strong>.</li>
  <li>In the pop-up dialog that appears, perform the following actions:
  <ul>
  <li>In the <strong>HTTP method</strong> list, select <strong>GET</strong>.</li>
  </ul>
  </li>
  <li>Select <strong>Run</strong> to test the function.</li>
  <li>Observe the result of the test run. The result should be your Azure Storage connection string.</li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you used a service identity to read the value of a secret stored in Key Vault and returned that value as the result of a function app.</p>
  </blockquote>
  </article>