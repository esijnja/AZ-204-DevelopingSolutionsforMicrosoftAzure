<article>
<h4><a id="user-content-task-1-upload-a-sample-storage-blob" class="anchor" aria-hidden="true" href="#task-1-upload-a-sample-storage-blob"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Upload a sample Storage blob</h4>
  <ol>
  <li>Access the <strong>securestor[yourname]</strong> storage account that you created earlier in this lab.</li>
  <li>Select the <strong>Containers</strong> link in the <strong>Blob service</strong> section, and then create a new container with the following settings:
  <ul>
  <li>Name: <strong>drop</strong></li>
  <li>Public access level: <strong>Blob (anonymous read access for blobs only)</strong></li>
  </ul>
  </li>
  <li>Browse to the new <strong>drop</strong> container, and then select <strong>Upload</strong> to upload the <strong>records.json</strong> file in the <strong>Allfiles (F): \Allfiles\Labs\07\Starter</strong> folder on your lab VM.
  <blockquote>
  <p><strong>Note:</strong> You should enable the <strong>Overwrite if files already exist</strong> option.</p>
  </blockquote>
  </li>
  <li>Find the metadata for the <strong>records.json</strong> blob by selecting the blob entry in the list of blobs.</li>
  <li>Using a new browser tab, go to to the URL for the blob, and then find the blob’s contents.</li>
  <li>Update the container’s access level by changing the <strong>Public access level</strong> to <strong>Private (no anonymous access)</strong>.</li>
  <li>Using a new browser window or tab, go to to the URL for the blob, and then find the blob’s contents. You should receive an error message indicating that the resource wasn't found.
  <blockquote>
  <p><strong>Note</strong>: If you don't receive the error message, your browser might have cached the file. Refresh the page until you receive the error message.</p>
  </blockquote>
  </li>
  </ol>
  <h4><a id="user-content-task-2-pull-and-configure-the-azure-sdk-for-net" class="anchor" aria-hidden="true" href="#task-2-pull-and-configure-the-azure-sdk-for-net"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Pull and configure the Azure SDK for .NET</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>When you receive the open command prompt, add version <strong>12.6.0</strong> of the <strong>Azure.Storage.Blobs</strong> package from NuGet:</p>
  <div class="highlight highlight-source-powershell"><pre>dotnet add package Azure.Storage.Blobs <span class="pl-k">--</span>version <span class="pl-c1">12.6</span>.<span class="pl-c1">0</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: The <a href="https://www.nuget.org/packages/Azure.Storage.Blobs/12.6.0" rel="nofollow">Azure.Storage.Blobs</a> NuGet package references the subset of the Azure SDK for .NET required to write code for Azure Blob Storage.</p>
  </blockquote>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Using <strong>Visual Studio Code</strong>, open the solution folder found at <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>.</p>
  </li>
  <li>
  <p>Open the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>Add a <strong>using directive</strong> for the <strong>Azure.Storage.Blobs</strong> namespace:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Azure</span>.<span class="pl-en">Storage</span>.<span class="pl-en">Blobs</span>;</pre></div>
  </li>
  </ol>
  <h4><a id="user-content-task-3-write-azure-blob-storage-code-using-the-azure-sdk-for-net" class="anchor" aria-hidden="true" href="#task-3-write-azure-blob-storage-code-using-the-azure-sdk-for-net"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Write Azure Blob Storage code using the Azure SDK for .NET</h4>
  <ol>
  <li>
  <p>Within the <strong>Run</strong> method of the <strong>FileParser</strong> class, delete the following line of code:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">OkObjectResult</span>(<span class="pl-smi">connectionString</span>);</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, create a new instance of the <strong>BlobClient</strong> class by passing in your <em>connectionString</em> variable, a  <code>"drop"</code> string value, and a <code>"records.json"</code> string value to the constructor:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-en">BlobClient</span> <span class="pl-smi">blob</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BlobClient</span>(<span class="pl-smi">connectionString</span>, <span class="pl-s"><span class="pl-pds">"</span>drop<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>records.json<span class="pl-pds">"</span></span>);</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, use the <strong>BlobClient.DownloadAsync</strong> method to download the contents of the referenced blob asynchronously and store the result in a variable named <em>response</em>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> <span class="pl-smi">response</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-smi">blob</span>.<span class="pl-en">DownloadAsync</span>();</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, return the value of the various content stored in the <em>content</em> variable by using the <strong>FileStreamResult</strong> class constructor:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">FileStreamResult</span>(<span class="pl-smi">response</span><span class="pl-k">?</span>.<span class="pl-smi">Value</span><span class="pl-k">?</span>.<span class="pl-smi">Content</span>, <span class="pl-smi">response</span><span class="pl-k">?</span>.<span class="pl-smi">Value</span><span class="pl-k">?</span>.<span class="pl-smi">ContentType</span>);</pre></div>
  </li>
  <li>
  <p><strong>Save</strong> the <strong>Echo.cs</strong> file.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-4-deploy-and-validate-the-azure-functions-app" class="anchor" aria-hidden="true" href="#task-4-deploy-and-validate-the-azure-functions-app"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Deploy and validate the Azure Functions app</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Log in to the Azure CLI by using your Azure credentials:</p>
  <div class="highlight highlight-source-powershell"><pre>az login</pre></div>
  </li>
  <li>
  <p>Publish the function app project again:</p>
  <div class="highlight highlight-source-powershell"><pre>func azure functionapp publish <span class="pl-k">&lt;</span>function<span class="pl-k">-</span>app<span class="pl-k">-</span>name<span class="pl-k">&gt;</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: As an example, if your <strong>Function App name</strong> is <strong>securefuncstudent</strong>, your command would be <code>func azure functionapp publish securefuncstudent</code>. You can review the documentation to [publish the local function app project][azure-functions-core-tools-publish-azure] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Wait for the deployment to finalize before you move forward with the lab.</p>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Sign in to the Azure portal (<a href="https://portal.azure.com" rel="nofollow">https://portal.azure.com</a>).</p>
  </li>
  <li>
  <p>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</p>
  </li>
  <li>
  <p>From the <strong>App Service</strong> blade, locate and open the <strong>Functions</strong> section, then locate and open the <strong>FileParser</strong> function.</p>
  </li>
  <li>
  <p>In the <strong>Function</strong> blade, select the <strong>Code + Test</strong> option from the <strong>Developer</strong> section.</p>
  </li>
  <li>
  <p>In the function editor, select <strong>Test/Run</strong>.</p>
  </li>
  <li>
  <p>In the pop-up dialog that appears, perform the following actions:</p>
  <ul>
  <li>In the <strong>HTTP method</strong> list, select <strong>GET</strong>.</li>
  </ul>
  </li>
  <li>
  <p>Select <strong>Run</strong> to test the function.</p>
  </li>
  <li>
  <p>Observe the results of the test run. The output will contain the content of the <strong>$/drop/records.json</strong> blob stored in your Azure Storage account.</p>
  </li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you used C# code to access a storage account and then downloaded the contents of a blob.</p>
  </blockquote>
  </article>