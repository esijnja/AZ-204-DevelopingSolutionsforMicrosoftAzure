<article>
    <tr>
    <th>lab</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td><div><table>
    <thead>
    <tr>
    <th>title</th>
    <th>az204Module</th>
    <th>az020Module</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td><div>Lab: Access resource secrets more securely across services</div></td>
    <td><div>Module 07: Implement secure cloud solutions</div></td>
    <td><div>Module 07: Implement secure cloud solutions</div></td>
    </tr>
    </tbody>
  </table>
  </div></td>
    </tr>
    </tbody>
  </table>
  
  <h1><a id="user-content-lab-access-resource-secrets-more-securely-across-services--student-lab-manual" class="anchor" aria-hidden="true" href="#lab-access-resource-secrets-more-securely-across-services--student-lab-manual"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Lab: Access resource secrets more securely across services | Student lab manual</h1>
  <h2><a id="user-content-lab-scenario" class="anchor" aria-hidden="true" href="#lab-scenario"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Lab scenario</h2>
  <p>Your company has a data-sharing business-to-business (B2B) agreement with another local business in which you're expected to parse a file that's dropped off nightly. To keep things simple, the second company has decided to drop the file as a Microsoft Azure Storage blob every night. You're now tasked with devising a way to access the file and generate a secure URL that any internal system can use to access the blob without exposing the file to the internet. You've decided to use Azure Key Vault to store the credentials for the storage account and Azure Functions to write the code necessary to access the file without storing credentials in plaintext or exposing the file to the internet.</p>
  <h2><a id="user-content-objectives" class="anchor" aria-hidden="true" href="#objectives"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Objectives</h2>
  <p>After you complete this lab, you'll be able to:</p>
  <ul>
  <li>Create an Azure Key Vault and store secrets in the key vault.</li>
  <li>Create a system-assigned managed identity for an Azure App Service instance.</li>
  <li>Create a Key Vault access policy for an Azure Active Directory identity or application.</li>
  <li>Use the Azure SDK for .NET to download a blob with an Azure Function.</li>
  </ul>
  <h2><a id="user-content-lab-setup" class="anchor" aria-hidden="true" href="#lab-setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Lab setup</h2>
  <ul>
  <li>Estimated time: <strong>45 minutes</strong></li>
  </ul>
  <h2><a id="user-content-instructions" class="anchor" aria-hidden="true" href="#instructions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Instructions</h2>
  <h3><a id="user-content-before-you-start" class="anchor" aria-hidden="true" href="#before-you-start"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Before you start</h3>
  <h4><a id="user-content-sign-in-to-the-lab-virtual-machine" class="anchor" aria-hidden="true" href="#sign-in-to-the-lab-virtual-machine"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sign in to the lab virtual machine</h4>
  <p>Ensure that you're signed in to your Windows 10 virtual machine (VM) by using the following credentials:</p>
  <ul>
  <li>Username: <strong>Admin</strong></li>
  <li>Password: <strong>Pa55w.rd</strong></li>
  </ul>
  <h4><a id="user-content-review-the-installed-applications" class="anchor" aria-hidden="true" href="#review-the-installed-applications"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Review the installed applications</h4>
  <p>Find the taskbar on your Windows 10 desktop. The taskbar contains the icons for the applications that you'll use in this lab:</p>
  <ul>
  <li>Microsoft Edge</li>
  <li>File Explorer</li>
  <li>Windows Terminal</li>
  <li>Visual Studio Code</li>
  </ul>
  <h3><a id="user-content-exercise-1-create-azure-resources" class="anchor" aria-hidden="true" href="#exercise-1-create-azure-resources"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exercise 1: Create Azure resources</h3>
  <h4><a id="user-content-task-1-open-the-azure-portal" class="anchor" aria-hidden="true" href="#task-1-open-the-azure-portal"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Open the Azure portal</h4>
  <ol>
  <li>Sign in to the Azure portal (<a href="https://portal.azure.com" rel="nofollow">https://portal.azure.com</a>).</li>
  <li>If this is your first time signing in to the Azure portal, a dialog box offering a tour of the portal displays. If you prefer to skip the tour, select <strong>Get Started</strong> to skip the tour.</li>
  </ol>
  <h4><a id="user-content-task-2-create-an-azure-storage-account" class="anchor" aria-hidden="true" href="#task-2-create-an-azure-storage-account"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Create an Azure Storage account</h4>
  <ol>
  <li>Create a new&nbsp;storage account&nbsp;with the following details:
  <ul>
  <li>New resource group: <strong>ConfidentialStack</strong></li>
  <li>Name: <strong>securestor[yourname]</strong></li>
  <li>Location: <strong>East US</strong></li>
  <li>Performance: <strong>Standard</strong></li>
  <li>Account kind: <strong>StorageV2 (general purpose v2)</strong></li>
  <li>Replication: <strong>Locally-redundant storage (LRS)</strong></li>
  <li>Access tier: <strong>Hot</strong></li>
  </ul>
  <blockquote>
  <p><strong>Note</strong>: Wait for Azure to finish creating the storage account before you move forward with the lab. You'll receive a notification when the&nbsp;account&nbsp;is created.</p>
  </blockquote>
  </li>
  <li>Open the&nbsp;<strong>Access Keys</strong>&nbsp;blade of your newly created&nbsp;storage account&nbsp;instance.</li>
  <li>Record the value in the&nbsp;<strong>Connection string</strong> text box. You'll use this value later in this lab.</li>
  </ol>
  <h4><a id="user-content-task-3-create-an-azure-key-vault" class="anchor" aria-hidden="true" href="#task-3-create-an-azure-key-vault"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Create an Azure key vault</h4>
  <ol>
  <li>Create a new key vault with the following details:
  <ul>
  <li>Existing resource group: <strong>ConfidentialStack</strong></li>
  <li>Name: <strong>securevault[yourname]</strong></li>
  <li>Region: <strong>East US</strong></li>
  <li>Pricing tier: <strong>Standard</strong></li>
  </ul>
  <blockquote>
  <p><strong>Note</strong>: Wait for Azure to finish creating the key vault before you move forward with the lab. You'll receive a notification when the&nbsp;vault&nbsp;is created.</p>
  </blockquote>
  </li>
  </ol>
  <h4><a id="user-content-task-4-create-an-azure-functions-app" class="anchor" aria-hidden="true" href="#task-4-create-an-azure-functions-app"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Create an Azure Functions app</h4>
  <ol>
  <li>
  <p>Create a new function app with the following details:</p>
  <ul>
  <li>Existing resource group: <strong>ConfidentialStack</strong></li>
  <li>App name: <strong>securefunc[yourname]</strong></li>
  <li>Publish: <strong>Code</strong></li>
  <li>Runtime Stack: <strong>.NET Core</strong></li>
  <li>Version: <strong>3.1</strong></li>
  <li>Region: <strong>East US</strong></li>
  <li>Operating system: <strong>Linux</strong></li>
  <li>Storage account: <strong>securestor[yourname]</strong></li>
  <li>Plan: <strong>Consumption (Serverless)</strong></li>
  <li>Enable Application Insights: <strong>Yes</strong></li>
  </ul>
  <blockquote>
  <p><strong>Note</strong>: Wait for Azure to finish creating the function app before you move forward with the lab. You'll receive a notification when the&nbsp;app&nbsp;is created.</p>
  </blockquote>
  </li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you created all the resources that you'll use for this lab.</p>
  </blockquote>
  <h3><a id="user-content-exercise-2-configure-secrets-and-identities" class="anchor" aria-hidden="true" href="#exercise-2-configure-secrets-and-identities"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exercise 2: Configure secrets and identities</h3>
  <h4><a id="user-content-task-1-configure-a-system-assigned-managed-service-identity" class="anchor" aria-hidden="true" href="#task-1-configure-a-system-assigned-managed-service-identity"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Configure a system-assigned managed service identity</h4>
  <ol>
  <li>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</li>
  <li>Browse to the <strong>Identity</strong> option from the <strong>Settings</strong> section.</li>
  <li>Enable the system-assigned managed identity, and then save your changes.</li>
  </ol>
  <h4><a id="user-content-task-2-create-a-key-vault-secret" class="anchor" aria-hidden="true" href="#task-2-create-a-key-vault-secret"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Create a Key Vault secret</h4>
  <ol>
  <li>Access the <strong>securevault[yourname]</strong> key vault that you created earlier in this lab.</li>
  <li>Select the <strong>Secrets</strong> link in the <strong>Settings</strong> section.</li>
  <li>Create a new secret with the following settings:
  <ul>
  <li>Name: <strong>storagecredentials</strong></li>
  <li>Value: <em><strong>Storage connection string</strong></em></li>
  <li>Enabled: <strong>Yes</strong></li>
  </ul>
  <blockquote>
  <p><strong>Note</strong>: Use the storage account connection string that you recorded earlier in this lab for the value of this secret.</p>
  </blockquote>
  </li>
  <li>Select through the secret to find the metadata for its latest version.</li>
  <li>Record the value of the <strong>Secret Identifier</strong> text box because you'll use this later in the lab.</li>
  </ol>
  <h4><a id="user-content-task-3-configure-a-key-vault-access-policy" class="anchor" aria-hidden="true" href="#task-3-configure-a-key-vault-access-policy"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Configure a Key Vault access policy</h4>
  <ol>
  <li>Access the <strong>securevault[yourname]</strong> key vault that you created earlier in this lab.</li>
  <li>Browse to the <strong>Access Policies</strong> link in the <strong>Settings</strong> section.</li>
  <li>Create a new access policy with the following settings:
  <ul>
  <li>Principal: <strong>securefunc[yourname]</strong>
  <blockquote>
  <p><strong>Note</strong>: The system-assigned managed identity you created earlier in this lab will have the same name as the Azure Functions resource.</p>
  </blockquote>
  </li>
  <li>Key permissions: <strong>None</strong></li>
  <li>Secret permissions: <strong>GET</strong></li>
  <li>Certificate permissions: <strong>None</strong></li>
  <li>Authorized application: <strong>None</strong></li>
  </ul>
  </li>
  <li>Save your changes to the list of <strong>Access Policies</strong>.</li>
  </ol>
  <h4><a id="user-content-task-4-create-a-key-vault-derived-application-setting" class="anchor" aria-hidden="true" href="#task-4-create-a-key-vault-derived-application-setting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Create a Key Vault-derived application setting</h4>
  <ol>
  <li>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</li>
  <li>Browse to the <strong>Configuration</strong> option from the <strong>Settings</strong> section.</li>
  <li>Create a new application setting by using the following details:
  <ul>
  <li>Name: <strong>StorageConnectionString</strong></li>
  <li>Value: <strong>@Microsoft.KeyVault(SecretUri=<em>Secret Identifier</em>)</strong></li>
  <li>Deployment slot setting: <strong>Not selected</strong></li>
  </ul>
  <blockquote>
  <p><strong>Note</strong>: You'll need to build a reference to your <em><strong>Secret Identifier</strong></em> by using the previous syntax. For example, if your <em><strong>Secret Identifier</strong></em> is <code>https://securevaultstudent.vault.azure.net/secrets/storagecredentials/17b41386df3e4191b92f089f5efb4cbf</code>, your value would be <code>@Microsoft.KeyVault(SecretUri=https://securevaultstudent.vault.azure.net/secrets/storagecredentials/17b41386df3e4191b92f089f5efb4cbf)</code>.</p>
  </blockquote>
  </li>
  <li>Save your changes to the application settings.</li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you created a system-assigned managed service identity for your function app and then gave that identity the appropriate permissions to get the value of a secret in your key vault. Finally, you created a secret that you referenced within your function app's configuration settings.</p>
  </blockquote>
  <h3><a id="user-content-exercise-3-build-an-azure-functions-app" class="anchor" aria-hidden="true" href="#exercise-3-build-an-azure-functions-app"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exercise 3: Build an Azure Functions app</h3>
  <h4><a id="user-content-task-1-initialize-a-function-project" class="anchor" aria-hidden="true" href="#task-1-initialize-a-function-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Initialize a function project</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> empty directory:</p>
  <div class="highlight highlight-source-powershell"><pre>cd F:\Allfiles\Labs\<span class="pl-c1">07</span>\Starter\func</pre></div>
  </li>
  <li>
  <p>Use the <strong>Azure Functions Core Tools</strong> to create a new local Azure Functions project with the following details:</p>
  <ul>
  <li>worker runtime: <strong>dotnet</strong></li>
  </ul>
  <div class="highlight highlight-source-powershell"><pre>func init <span class="pl-k">--</span>worker<span class="pl-k">-</span>runtime dotnet</pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [create a new project][azure-functions-core-tools-new-project] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p><strong>Build</strong> the .NET Core 3.1 project:</p>
  <div class="highlight highlight-source-powershell"><pre>dotnet build</pre></div>
  </li>
  </ol>
  <h4><a id="user-content-task-2-create-an-http-triggered-function" class="anchor" aria-hidden="true" href="#task-2-create-an-http-triggered-function"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Create an HTTP-triggered function</h4>
  <ol>
  <li>
  <p>Still in the open command prompt,create a new function with the following details:</p>
  <ul>
  <li>template: <strong>HTTP trigger</strong></li>
  <li>name: <strong>FileParser</strong></li>
  </ul>
  <div class="highlight highlight-source-powershell"><pre>func new <span class="pl-k">--</span>template <span class="pl-s"><span class="pl-pds">"</span>HTTP trigger<span class="pl-pds">"</span></span> <span class="pl-k">--</span>name <span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [create a new function][azure-functions-core-tools-new-function] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-3-configure-and-read-an-application-setting" class="anchor" aria-hidden="true" href="#task-3-configure-and-read-an-application-setting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Configure and read an application setting</h4>
  <ol>
  <li>
  <p>Open <strong>Visual Studio Code</strong>.</p>
  </li>
  <li>
  <p>Using <strong>Visual Studio Code</strong>, open the solution folder found at <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>.</p>
  </li>
  <li>
  <p>Open the <strong>local.settings.json</strong> file.</p>
  </li>
  <li>
  <p>Update the value of the <strong>Values</strong> object by adding a new setting named <strong>StorageConnectionString</strong> and setting it to a string value of <strong>[TEST VALUE]</strong>:</p>
  <div class="highlight highlight-source-json"><pre><span class="pl-s"><span class="pl-pds">"</span>Values<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>AzureWebJobsStorage<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>UseDevelopmentStorage=true<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>FUNCTIONS_WORKER_RUNTIME<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>dotnet<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>[TEST VALUE]<span class="pl-pds">"</span></span>
  }</pre></div>
  </li>
  <li>
  <p>Open the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>In the code editor, delete all the code within the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>Add <strong>using directives</strong> for the <strong>Microsoft.AspNetCore.Mvc</strong>, <strong>Microsoft.Azure.WebJobs</strong>, <strong>Microsoft.AspNetCore.Http</strong>, <strong>System</strong>, and <strong>System.Threading.Tasks</strong> namespaces:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">AspNetCore</span>.<span class="pl-en">Mvc</span>;
  <span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">Azure</span>.<span class="pl-en">WebJobs</span>;
  <span class="pl-k">using</span> <span class="pl-en">Microsoft</span>.<span class="pl-en">AspNetCore</span>.<span class="pl-en">Http</span>;
  <span class="pl-k">using</span> <span class="pl-en">System</span>;
  <span class="pl-k">using</span> <span class="pl-en">System</span>.<span class="pl-en">Threading</span>.<span class="pl-en">Tasks</span>;</pre></div>
  </li>
  <li>
  <p>Create a new <strong>public static</strong> class named <strong>FileParser</strong>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">FileParser</span>
  { }</pre></div>
  </li>
  <li>
  <p>Within the <strong>FileParser</strong> class, create a new <strong>public static</strong> <em>asynchronous</em> method named <strong>Run</strong> that returns a variable of type <strong>Task&lt;IActionResult&gt;</strong> and that also takes in a variable of type <strong>HttpRequest</strong> named <em>request</em>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Append an attribute to the <strong>Run</strong> method of type <strong>FunctionNameAttribute</strong> that has its <strong>name</strong> parameter set to a value of <strong>FileParser</strong>:</p>
  <div class="highlight highlight-source-cs"><pre>[<span class="pl-en">FunctionName</span>(<span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span>)]
  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Append an attribute to the <strong>request</strong> parameter of type <strong>HttpTriggerAttribute</strong> that has its <strong>methods</strong> parameter array set to a single value of <strong>GET</strong>:</p>
  <div class="highlight highlight-source-cs"><pre>[<span class="pl-en">FunctionName</span>(<span class="pl-s"><span class="pl-pds">"</span>FileParser<span class="pl-pds">"</span></span>)]
  <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">IActionResult</span>&gt; <span class="pl-en">Run</span>(
      [<span class="pl-en">HttpTrigger</span>(<span class="pl-s"><span class="pl-pds">"</span>GET<span class="pl-pds">"</span></span>)] <span class="pl-en">HttpRequest</span> <span class="pl-smi">request</span>)
  { }</pre></div>
  </li>
  <li>
  <p>Within the <strong>Run</strong> method, retrieve the value of the <strong>StorageConnectionString</strong> application setting by using the <strong>Environment.GetEnvironmentVariable</strong> method and storing the result in a <strong>string</strong> variable named <strong>connectionString</strong>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">string</span> <span class="pl-smi">connectionString</span> <span class="pl-k">=</span> <span class="pl-smi">Environment</span>.<span class="pl-en">GetEnvironmentVariable</span>(<span class="pl-s"><span class="pl-pds">"</span>StorageConnectionString<span class="pl-pds">"</span></span>);</pre></div>
  </li>
  <li>
  <p>Finally, return the value of the <strong>connectionString</strong> variable as the HTTP response:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">OkObjectResult</span>(<span class="pl-smi">connectionString</span>);</pre></div>
  </li>
  <li>
  <p><strong>Save</strong> the <strong>Echo.cs</strong> file.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-4-validate-the-local-function" class="anchor" aria-hidden="true" href="#task-4-validate-the-local-function"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Validate the local function</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Start the function app project:</p>
  <div class="highlight highlight-source-powershell"><pre>func start <span class="pl-k">--</span>build</pre></div>
  <blockquote>
  <p><strong>Note</strong>: You can review the documentation to [start the function app project locally][azure-functions-core-tools-start-function] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Open a new instance of the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Start the <strong>httprepl</strong> tool, and then set the base Uniform Resource Identifier (URI) to <code>http://localhost:7071</code>:</p>
  <div class="highlight highlight-source-powershell"><pre>httprepl http:<span class="pl-k">//</span>localhost:<span class="pl-c1">7071</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: An error message is displayed by the httprepl tool. This message occurs because the tool is searching for a Swagger definition file to use to "traverse" the API. Because your functio projectp does not produce a Swagger definition file, you'll need to traverse the API manually.</p>
  </blockquote>
  </li>
  <li>
  <p>When you receive the tool prompt, browse to the relative <strong>api/fileparser</strong> directory:</p>
  <div class="highlight highlight-source-powershell"><pre>cd api
  cd fileparser</pre></div>
  </li>
  <li>
  <p>Run the <strong>get</strong> command:</p>
  <div class="highlight highlight-source-powershell"><pre>get</pre></div>
  </li>
  <li>
  <p>Observe the <strong>[TEST VALUE]</strong> value of the <strong>StorageConnectionString</strong> being returned as the result of the HTTP request.</p>
  </li>
  <li>
  <p>Exit the <strong>httprepl</strong> application:</p>
  <div class="highlight highlight-source-powershell"><pre><span class="pl-k">exit</span></pre></div>
  </li>
  <li>
  <p>Close all currently running instances of the <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-5-deploy-using-the-azure-functions-core-tools" class="anchor" aria-hidden="true" href="#task-5-deploy-using-the-azure-functions-core-tools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 5: Deploy using the Azure Functions Core Tools</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Log in to the Azure Command-Line Interface (CLI) by using your Azure credentials:</p>
  <div class="highlight highlight-source-powershell"><pre>az login</pre></div>
  </li>
  <li>
  <p>Publish the function app project:</p>
  <div class="highlight highlight-source-powershell"><pre>func azure functionapp publish <span class="pl-k">&lt;</span>function<span class="pl-k">-</span>app<span class="pl-k">-</span>name<span class="pl-k">&gt;</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: For example, if your <strong>Function App name</strong> is <strong>securefuncstudent</strong>, your command would be <code>func azure functionapp publish securefuncstudent</code>. You can review the documentation to [publish the local function app project][azure-functions-core-tools-publish-azure] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Wait for the deployment to finalize before you move forward with the lab.</p>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-6-test-the-key-vault-derived-application-setting" class="anchor" aria-hidden="true" href="#task-6-test-the-key-vault-derived-application-setting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 6: Test the Key Vault-derived application setting</h4>
  <ol>
  <li>Sign in to the Azure portal (<a href="https://portal.azure.com" rel="nofollow">https://portal.azure.com</a>).</li>
  <li>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</li>
  <li>From the <strong>App Service</strong> blade, locate and open the <strong>Functions</strong> section, and then locate and open the <strong>FileParser</strong> function.</li>
  <li>In the <strong>Function</strong> blade, select the <strong>Code + Test</strong> option from the <strong>Developer</strong> section.</li>
  <li>In the function editor, select <strong>Test/Run</strong>.</li>
  <li>In the pop-up dialog that appears, perform the following actions:
  <ul>
  <li>In the <strong>HTTP method</strong> list, select <strong>GET</strong>.</li>
  </ul>
  </li>
  <li>Select <strong>Run</strong> to test the function.</li>
  <li>Observe the result of the test run. The result should be your Azure Storage connection string.</li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you used a service identity to read the value of a secret stored in Key Vault and returned that value as the result of a function app.</p>
  </blockquote>
  <h3><a id="user-content-exercise-4-access-azure-blob-storage-data" class="anchor" aria-hidden="true" href="#exercise-4-access-azure-blob-storage-data"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exercise 4: Access Azure Blob Storage data</h3>
  <h4><a id="user-content-task-1-upload-a-sample-storage-blob" class="anchor" aria-hidden="true" href="#task-1-upload-a-sample-storage-blob"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Upload a sample Storage blob</h4>
  <ol>
  <li>Access the <strong>securestor[yourname]</strong> storage account that you created earlier in this lab.</li>
  <li>Select the <strong>Containers</strong> link in the <strong>Blob service</strong> section, and then create a new container with the following settings:
  <ul>
  <li>Name: <strong>drop</strong></li>
  <li>Public access level: <strong>Blob (anonymous read access for blobs only)</strong></li>
  </ul>
  </li>
  <li>Browse to the new <strong>drop</strong> container, and then select <strong>Upload</strong> to upload the <strong>records.json</strong> file in the <strong>Allfiles (F): \Allfiles\Labs\07\Starter</strong> folder on your lab VM.
  <blockquote>
  <p><strong>Note:</strong> You should enable the <strong>Overwrite if files already exist</strong> option.</p>
  </blockquote>
  </li>
  <li>Find the metadata for the <strong>records.json</strong> blob by selecting the blob entry in the list of blobs.</li>
  <li>Using a new browser tab, go to to the URL for the blob, and then find the blob’s contents.</li>
  <li>Update the container’s access level by changing the <strong>Public access level</strong> to <strong>Private (no anonymous access)</strong>.</li>
  <li>Using a new browser window or tab, go to to the URL for the blob, and then find the blob’s contents. You should receive an error message indicating that the resource wasn't found.
  <blockquote>
  <p><strong>Note</strong>: If you don't receive the error message, your browser might have cached the file. Refresh the page until you receive the error message.</p>
  </blockquote>
  </li>
  </ol>
  <h4><a id="user-content-task-2-pull-and-configure-the-azure-sdk-for-net" class="anchor" aria-hidden="true" href="#task-2-pull-and-configure-the-azure-sdk-for-net"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Pull and configure the Azure SDK for .NET</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>When you receive the open command prompt, add version <strong>12.6.0</strong> of the <strong>Azure.Storage.Blobs</strong> package from NuGet:</p>
  <div class="highlight highlight-source-powershell"><pre>dotnet add package Azure.Storage.Blobs <span class="pl-k">--</span>version <span class="pl-c1">12.6</span>.<span class="pl-c1">0</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: The <a href="https://www.nuget.org/packages/Azure.Storage.Blobs/12.6.0" rel="nofollow">Azure.Storage.Blobs</a> NuGet package references the subset of the Azure SDK for .NET required to write code for Azure Blob Storage.</p>
  </blockquote>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Using <strong>Visual Studio Code</strong>, open the solution folder found at <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>.</p>
  </li>
  <li>
  <p>Open the <strong>FileParser.cs</strong> file.</p>
  </li>
  <li>
  <p>Add a <strong>using directive</strong> for the <strong>Azure.Storage.Blobs</strong> namespace:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Azure</span>.<span class="pl-en">Storage</span>.<span class="pl-en">Blobs</span>;</pre></div>
  </li>
  </ol>
  <h4><a id="user-content-task-3-write-azure-blob-storage-code-using-the-azure-sdk-for-net" class="anchor" aria-hidden="true" href="#task-3-write-azure-blob-storage-code-using-the-azure-sdk-for-net"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Write Azure Blob Storage code using the Azure SDK for .NET</h4>
  <ol>
  <li>
  <p>Within the <strong>Run</strong> method of the <strong>FileParser</strong> class, delete the following line of code:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">OkObjectResult</span>(<span class="pl-smi">connectionString</span>);</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, create a new instance of the <strong>BlobClient</strong> class by passing in your <em>connectionString</em> variable, a  <code>"drop"</code> string value, and a <code>"records.json"</code> string value to the constructor:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-en">BlobClient</span> <span class="pl-smi">blob</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BlobClient</span>(<span class="pl-smi">connectionString</span>, <span class="pl-s"><span class="pl-pds">"</span>drop<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>records.json<span class="pl-pds">"</span></span>);</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, use the <strong>BlobClient.DownloadAsync</strong> method to download the contents of the referenced blob asynchronously and store the result in a variable named <em>response</em>:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> <span class="pl-smi">response</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-smi">blob</span>.<span class="pl-en">DownloadAsync</span>();</pre></div>
  </li>
  <li>
  <p>Still within the <strong>Run</strong> method, return the value of the various content stored in the <em>content</em> variable by using the <strong>FileStreamResult</strong> class constructor:</p>
  <div class="highlight highlight-source-cs"><pre><span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">FileStreamResult</span>(<span class="pl-smi">response</span><span class="pl-k">?</span>.<span class="pl-smi">Value</span><span class="pl-k">?</span>.<span class="pl-smi">Content</span>, <span class="pl-smi">response</span><span class="pl-k">?</span>.<span class="pl-smi">Value</span><span class="pl-k">?</span>.<span class="pl-smi">ContentType</span>);</pre></div>
  </li>
  <li>
  <p><strong>Save</strong> the <strong>Echo.cs</strong> file.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-4-deploy-and-validate-the-azure-functions-app" class="anchor" aria-hidden="true" href="#task-4-deploy-and-validate-the-azure-functions-app"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Deploy and validate the Azure Functions app</h4>
  <ol>
  <li>
  <p>Open the <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Change the current directory to the <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> project directory.</p>
  </li>
  <li>
  <p>Log in to the Azure CLI by using your Azure credentials:</p>
  <div class="highlight highlight-source-powershell"><pre>az login</pre></div>
  </li>
  <li>
  <p>Publish the function app project again:</p>
  <div class="highlight highlight-source-powershell"><pre>func azure functionapp publish <span class="pl-k">&lt;</span>function<span class="pl-k">-</span>app<span class="pl-k">-</span>name<span class="pl-k">&gt;</span></pre></div>
  <blockquote>
  <p><strong>Note</strong>: As an example, if your <strong>Function App name</strong> is <strong>securefuncstudent</strong>, your command would be <code>func azure functionapp publish securefuncstudent</code>. You can review the documentation to [publish the local function app project][azure-functions-core-tools-publish-azure] using the <strong>Azure Functions Core Tools</strong>.</p>
  </blockquote>
  </li>
  <li>
  <p>Wait for the deployment to finalize before you move forward with the lab.</p>
  </li>
  <li>
  <p>Close the currently running <strong>Windows Terminal</strong> application.</p>
  </li>
  <li>
  <p>Sign in to the Azure portal (<a href="https://portal.azure.com" rel="nofollow">https://portal.azure.com</a>).</p>
  </li>
  <li>
  <p>Access the <strong>securefunc[yourname]</strong> function app that you created earlier in this lab.</p>
  </li>
  <li>
  <p>From the <strong>App Service</strong> blade, locate and open the <strong>Functions</strong> section, then locate and open the <strong>FileParser</strong> function.</p>
  </li>
  <li>
  <p>In the <strong>Function</strong> blade, select the <strong>Code + Test</strong> option from the <strong>Developer</strong> section.</p>
  </li>
  <li>
  <p>In the function editor, select <strong>Test/Run</strong>.</p>
  </li>
  <li>
  <p>In the pop-up dialog that appears, perform the following actions:</p>
  <ul>
  <li>In the <strong>HTTP method</strong> list, select <strong>GET</strong>.</li>
  </ul>
  </li>
  <li>
  <p>Select <strong>Run</strong> to test the function.</p>
  </li>
  <li>
  <p>Observe the results of the test run. The output will contain the content of the <strong>$/drop/records.json</strong> blob stored in your Azure Storage account.</p>
  </li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you used C# code to access a storage account and then downloaded the contents of a blob.</p>
  </blockquote>
  <h3><a id="user-content-exercise-5-clean-up-your-subscription" class="anchor" aria-hidden="true" href="#exercise-5-clean-up-your-subscription"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exercise 5: Clean up your subscription</h3>
  <h4><a id="user-content-task-1-open-azure-cloud-shell-and-list-resource-groups" class="anchor" aria-hidden="true" href="#task-1-open-azure-cloud-shell-and-list-resource-groups"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Open Azure Cloud Shell and list resource groups</h4>
  <ol>
  <li>
  <p>In the portal, select the <strong>Cloud Shell</strong> icon to open a new shell instance.</p>
  </li>
  <li>
  <p>If <strong>Cloud Shell</strong> isn't already configured, configure the shell for Bash by using the default settings.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-2-delete-a-resource-group" class="anchor" aria-hidden="true" href="#task-2-delete-a-resource-group"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Delete a resource group</h4>
  <ol>
  <li>
  <p>Enter the following command, and then select Enter to delete the <strong>ConfidentialStack</strong> resource group:</p>
  <div class="highlight highlight-source-powershell"><pre>az group delete <span class="pl-k">--</span>name ConfidentialStack <span class="pl-k">--</span>no<span class="pl-k">-</span>wait <span class="pl-k">--</span>yes</pre></div>
  </li>
  <li>
  <p>Close the Cloud Shell pane from the portal.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-3-close-the-active-application" class="anchor" aria-hidden="true" href="#task-3-close-the-active-application"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Close the active application</h4>
  <ol>
  <li>Close the currently running Microsoft Edge application.</li>
  </ol>
  <blockquote>
  <p><strong>Review</strong>: In this exercise, you cleaned up your subscription by removing the resource groups that were used in this lab.</p>
  </blockquote>
  </article>