<article>
<h4><a id="user-content-task-1-create-a-migration-project" class="anchor" aria-hidden="true" href="#task-1-create-a-migration-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Create a migration project</h4>
  <ol>
  <li>
  <p>Using a terminal, create a new .NET console project named <strong>AdventureWorks.Migrate</strong> in a folder with the same name:</p>
  <pre><code>dotnet new console --name AdventureWorks.Migrate
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet new</strong> command will create a new <strong>console</strong> project in a folder with the same name as the project.</p>
  </blockquote>
  </li>
  <li>
  <p>Using the same terminal, add a reference to the existing <strong>AdventureWorks.Models</strong> project:</p>
  <pre><code>dotnet add .\AdventureWorks.Migrate\AdventureWorks.Migrate.csproj reference .\AdventureWorks.Models\AdventureWorks.Models.csproj
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet add reference</strong> command will add a reference to the model classes contained in the <strong>AdventureWorks.Models</strong> project.</p>
  </blockquote>
  </li>
  <li>
  <p>Using the same terminal, add a reference to the existing <strong>AdventureWorks.Context</strong> project:</p>
  <pre><code>dotnet add .\AdventureWorks.Migrate\AdventureWorks.Migrate.csproj reference .\AdventureWorks.Context\AdventureWorks.Context.csproj
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet add reference</strong> command will add a reference to the context classes contained in the <strong>AdventureWorks.Context</strong> project.</p>
  </blockquote>
  </li>
  <li>
  <p>Using the same terminal, change your context to the <strong>AdventureWorks.Migrate</strong> folder:</p>
  <pre><code>cd .\AdventureWorks.Migrate\
  </code></pre>
  </li>
  <li>
  <p>Using the same terminal, import version 3.0.1 of <strong>Microsoft.EntityFrameworkCore.SqlServer</strong> from NuGet:</p>
  <pre><code>dotnet add package Microsoft.EntityFrameworkCore.SqlServer --version 3.0.1
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.EntityFrameworkCore.SqlServer</strong> package from <strong>NuGet</strong>. For more information, go to: <a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/3.0.1" rel="nofollow">Microsoft.EntityFrameworkCore.SqlServer</a>.</p>
  </blockquote>
  </li>
  <li>
  <p>Using the same terminal, import version 3.4.1 of <strong>Microsoft.Azure.Cosmos</strong> from NuGet:</p>
  <pre><code>dotnet add package Microsoft.Azure.Cosmos --version 3.4.1
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet add package</strong> command will add the <strong>Microsoft.Azure.Cosmos</strong> package from <strong>NuGet</strong>. For more information, go to: <a href="https://www.nuget.org/packages/Microsoft.Azure.Cosmos/3.4.1" rel="nofollow">Microsoft.Azure.Cosmos</a>.</p>
  </blockquote>
  </li>
  <li>
  <p>Using the same terminal, build the .NET console application:</p>
  <pre><code>dotnet build
  </code></pre>
  </li>
  <li>
  <p>Close the current terminal.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-2-create-a-net-class" class="anchor" aria-hidden="true" href="#task-2-create-a-net-class"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Create a .NET class</h4>
  <ol>
  <li>
  <p>Open the <strong>AdventureWorks.Migrate/Program.cs</strong> file in Visual Studio Code.</p>
  </li>
  <li>
  <p>Delete all existing code in the <strong>Program.cs</strong> file.</p>
  </li>
  <li>
  <p>Add the following <strong>using</strong> directives for libraries that will be referenced by the application:</p>
  <pre><code>using AdventureWorks.Context;
  using AdventureWorks.Models;
  using Microsoft.Azure.Cosmos;
  using Microsoft.EntityFrameworkCore;
  using System;
  using System.Collections.Generic;
  using System.Linq;
  using System.Threading.Tasks;
  </code></pre>
  </li>
  <li>
  <p>Create a new <strong>Program</strong> class with two constant string properties and an asynchronous <strong>Main</strong> entry point method:</p>
  <pre><code>public class Program
  {
      private const string sqlDBConnectionString = "";
      private const string cosmosDBConnectionString = "";
      
      public static async Task Main(string[] args)
      {
      }
  }
  </code></pre>
  </li>
  <li>
  <p>Update the <strong>sqlDBConnectionString</strong> string constant by setting its value to the&nbsp;<strong>ADO.NET (SQL Authentication) connection string</strong>&nbsp;of the&nbsp;SQL database&nbsp;that you recorded earlier in this lab.</p>
  <blockquote>
  <p><strong>Note</strong>: It's important that you use your updated connection string here. The original connection string copied from the portal won't have the username and password necessary to connect to the SQL database.</p>
  </blockquote>
  </li>
  <li>
  <p>Update the <strong>cosmosDBConnectionString</strong> string constant by setting its value to the&nbsp;<strong>PRIMARY CONNECTION STRING</strong> of the Azure Cosmos DB account that you recorded earlier in this lab.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-3-get-sql-database-records-by-using-entity-framework" class="anchor" aria-hidden="true" href="#task-3-get-sql-database-records-by-using-entity-framework"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Get SQL database records by using Entity Framework</h4>
  <ol>
  <li>
  <p>Within the <strong>Main</strong> method, add the following blocks of code to export all model and product records from SQL Database to local memory:</p>
  <pre><code>await Console.Out.WriteLineAsync("Start Migration");
  
  using AdventureWorksSqlContext context = new AdventureWorksSqlContext(sqlDBConnectionString);
  
  List&lt;Model&gt; items = await context.Models
      .Include(m =&gt; m.Products)
      .ToListAsync&lt;Model&gt;();
  
  await Console.Out.WriteLineAsync($"Total Azure SQL DB Records: {items.Count}");
  </code></pre>
  </li>
  <li>
  <p>Save the&nbsp;<strong>Program.cs</strong>&nbsp;file.</p>
  </li>
  <li>
  <p>Using a terminal, change your context to the <strong>AdventureWorks.Migrate</strong> folder:</p>
  <pre><code>cd .\AdventureWorks.Migrate\
  </code></pre>
  </li>
  <li>
  <p>Using the same terminal, build the .NET console application project:</p>
  <pre><code>dotnet build
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\04\Solution\AdventureWorks\AdventureWorks.Migrate</strong> folder.</p>
  </blockquote>
  </li>
  <li>
  <p>Close the current terminal.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-4-insert-items-into-azure-cosmos-db" class="anchor" aria-hidden="true" href="#task-4-insert-items-into-azure-cosmos-db"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 4: Insert items into Azure Cosmos DB</h4>
  <ol>
  <li>
  <p>Still within the <strong>Main</strong> method, add the following blocks of code to import the in-memory model and product data as documents to Azure Cosmos DB:</p>
  <pre><code>using CosmosClient client = new CosmosClient(cosmosDBConnectionString);
  
  Database database = await client.CreateDatabaseIfNotExistsAsync("Retail");
  
  Container container = await database.CreateContainerIfNotExistsAsync("Online",
      partitionKeyPath: $"/{nameof(Model.Category)}",
      throughput: 1000
  );
  
  int count = 0;
  foreach (var item in items)
  {
      ItemResponse&lt;Model&gt; document = await container.UpsertItemAsync&lt;Model&gt;(item);
      await Console.Out.WriteLineAsync($"Upserted document #{++count:000} [Activity Id: {document.ActivityId}]");
  }
  
  await Console.Out.WriteLineAsync($"Total Azure Cosmos DB Documents: {count}");
  </code></pre>
  </li>
  <li>
  <p>Save the&nbsp;<strong>Program.cs</strong>&nbsp;file.</p>
  </li>
  <li>
  <p>Using a terminal, change your context to the <strong>AdventureWorks.Migrate</strong> folder:</p>
  <pre><code>cd .\AdventureWorks.Migrate\
  </code></pre>
  </li>
  <li>
  <p>Using the same terminal, build the .NET console application project:</p>
  <pre><code>dotnet build
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\04\Solution\AdventureWorks\AdventureWorks.Migrate</strong> folder.</p>
  </blockquote>
  </li>
  </ol>
  <h4><a id="user-content-task-5-perform-a-migration" class="anchor" aria-hidden="true" href="#task-5-perform-a-migration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 5: Perform a migration</h4>
  <ol>
  <li>
  <p>Using the same terminal, run the .NET console application project:</p>
  <pre><code>dotnet run
  </code></pre>
  <blockquote>
  <p><strong>Note</strong>: The <strong>dotnet run</strong> command will start the console application.</p>
  </blockquote>
  </li>
  <li>
  <p>Observe the various data that prints to the screen, including initial SQL record count, individual upsert activity identifiers, and final Azure Cosmos DB document count.</p>
  </li>
  <li>
  <p>Close the current terminal.</p>
  </li>
  </ol>
  <h4><a id="user-content-task-6-validate-the-migration" class="anchor" aria-hidden="true" href="#task-6-validate-the-migration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 6: Validate the migration</h4>
  <ol>
  <li>
  <p>Return to the <strong>Microsoft Edge</strong> browser window with the Azure portal.</p>
  </li>
  <li>
  <p>Go to the blade for the <em><em>polycosmos</em>[yourname]</em>** Azure Cosmos DB account that you created earlier in this lab.</p>
  </li>
  <li>
  <p>Open the Data Explorer pane.</p>
  </li>
  <li>
  <p>Create a new <strong>SQL query</strong> tab within the context of the <strong>Retail</strong> database and <strong>Online</strong> container.</p>
  </li>
  <li>
  <p>Run the following query, and then observe the results:</p>
  <pre><code>SELECT * FROM models
  </code></pre>
  </li>
  <li>
  <p>Run the following query, and then observe the results:</p>
  <pre><code>SELECT VALUE COUNT(1) FROM models
  </code></pre>
  </li>
  </ol>
  <h4><a id="user-content-review-3" class="anchor" aria-hidden="true" href="#review-3"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Review</h4>
  <p>In this exercise, you used Entity Framework and the .NET SDK for Azure Cosmos DB to migrate data from SQL Database to Azure Cosmos DB.</p>
  </article>