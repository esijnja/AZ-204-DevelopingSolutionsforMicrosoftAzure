<article>
<h4><a id="user-content-task-1-write-code-to-access-queue-messages" class="anchor" aria-hidden="true" href="#task-1-write-code-to-access-queue-messages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 1: Write code to access queue messages</h4>
<ol>
<li>
<p>In the <strong>Main</strong> method, perform the following actions:</p>
<ol>
<li>
<p>Render a header by using the <strong>Console.WriteLine</strong> static method:</p>
<pre><code>Console.WriteLine($"---Existing Messages---");
</code></pre>
</li>
<li>
<p>Add the following block of code to create variables that will be used when retrieving queue messages:</p>
<pre><code>int batchSize = 10;
TimeSpan visibilityTimeout = TimeSpan.FromSeconds(2.5d);
</code></pre>
</li>
<li>
<p>Add the following block of code to retrieve a batch of messages asynchronously from the queue service and iterate over the messages:</p>
<pre><code>Response&lt;QueueMessage[]&gt; messages = await client.ReceiveMessagesAsync(batchSize, visibilityTimeout);
foreach(QueueMessage message in messages?.Value)
{
}
</code></pre>
</li>
<li>
<p>Within the <strong>foreach</strong> block, render the <strong>MessageId</strong> and <strong>MessageText</strong> properties of the <strong><a href="https://docs.microsoft.com/dotnet/api/azure.storage.queues.models.queuemessage" rel="nofollow">QueueMessage</a></strong> instance:</p>
<pre><code>Console.WriteLine($"[{message.MessageId}]\t{message.MessageText}");
</code></pre>
</li>
</ol>
</li>
<li>
<p>Save the&nbsp;<strong>Program.cs</strong>&nbsp;file.</p>
</li>
<li>
<p>Using a terminal, build the ASP.NET web application project:</p>
<pre><code>dotnet build
</code></pre>
<blockquote>
<p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\11\Solution\MessageProcessor</strong> folder.</p>
</blockquote>
</li>
<li>
<p>Close the current terminal.</p>
</li>
</ol>
<h4><a id="user-content-task-2-test-message-queue-access" class="anchor" aria-hidden="true" href="#task-2-test-message-queue-access"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 2: Test message queue access</h4>
<ol>
<li>
<p>Using a terminal, run the ASP.NET web application project:</p>
<pre><code>dotnet run
</code></pre>
<blockquote>
<p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\11\Solution\MessageProcessor</strong> folder.</p>
</blockquote>
</li>
<li>
<p>Observe the output from the currently running console application. The output indicates that no messages are in the queue.</p>
</li>
<li>
<p>Close the current terminal.</p>
</li>
<li>
<p>Find the <em><em>asyncstor</em>[yourname]</em>** Storage account that you created earlier in this lab.</p>
</li>
<li>
<p>In the <strong>Overview</strong> section of the blade, select <strong>Open in Explorer</strong> to open the Storage account by using Storage Explorer.</p>
</li>
<li>
<p>In the <strong>Azure Storage Explorer</strong> application, sign in to your Azure account.</p>
</li>
<li>
<p>From the <strong>Azure Storage Explorer</strong> application, in the <strong>EXPLORER</strong> pane, find and expand the <em><em>asyncstor</em>[yourname]</em>** storage account that you created earlier in this lab.</p>
</li>
<li>
<p>Within the <em><em>asyncstor</em>[yourname]</em>** node for the Storage account that you created earlier in this lab, find and open the <strong>messagequeue</strong> queue.</p>
</li>
<li>
<p>Add a new message to the queue with the following properties:</p>
<ul>
<li>
<p>Message text: <strong>Hello World</strong></p>
</li>
<li>
<p>Expires in: <strong>12 Hours</strong></p>
</li>
<li>
<p>Encode message body in Base 64: <strong>No</strong></p>
</li>
</ul>
</li>
<li>
<p>Return to the Visual Studio Code application.</p>
</li>
<li>
<p>Using a terminal, run the ASP.NET web application project:</p>
<pre><code>dotnet run
</code></pre>
<blockquote>
<p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\11\Solution\MessageProcessor</strong> folder.</p>
</blockquote>
</li>
<li>
<p>Observe the output from the currently running console application. The output includes the new message that you created.</p>
</li>
<li>
<p>Close the current terminal.</p>
</li>
</ol>
<h4><a id="user-content-task-3-delete-queued-messages" class="anchor" aria-hidden="true" href="#task-3-delete-queued-messages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Task 3: Delete queued messages</h4>
<ol>
<li>
<p>In the <strong>Visual Studio Code</strong> window, open the <strong>Program.cs</strong> file.</p>
</li>
<li>
<p>Update the <strong>foreach</strong> loop's block of code to invoke the <strong>DeleteMessageAsync</strong> method of the <strong>QueueMessage</strong> class, passing in the <strong>MessageId</strong> and <strong>PopReceipt</strong> properties of the <em>message</em> variable:</p>
<pre><code>foreach(QueueMessage message in messages?.Value)
{
    Console.WriteLine($"[{message.MessageId}]\t{message.MessageText}");
    await client.DeleteMessageAsync(message.MessageId, message.PopReceipt);
}
</code></pre>
</li>
<li>
<p><strong>Save</strong> the <strong>Program.cs</strong> file.</p>
</li>
<li>
<p>Using a terminal, run the ASP.NET web application project:</p>
<pre><code>dotnet run
</code></pre>
<blockquote>
<p><strong>Note</strong>: If there are any build errors, review the <strong>Program.cs</strong> file in the <strong>Allfiles (F):\Allfiles\Labs\11\Solution\MessageProcessor</strong> folder.</p>
</blockquote>
</li>
<li>
<p>Observe the output from the currently running console application. The message that you created earlier in the lab still exists because it hasn't been deleted previously.</p>
</li>
<li>
<p>Close the current terminal.</p>
</li>
<li>
<p>In the <strong>Azure Storage Explorer</strong> window, within the <em><em>asyncstor</em>[yourname]</em>** node for the Storage account that you created earlier in this lab, find and open the <strong>messagequeue</strong> queue.</p>
</li>
<li>
<p>Observe the empty list of messages in the queue.</p>
<blockquote>
<p><strong>Note</strong>: You might need to refresh the queue.</p>
</blockquote>
</li>
</ol>
<h4><a id="user-content-review-2" class="anchor" aria-hidden="true" href="#review-2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Review</h4>
<p>In this exercise, you read and deleted existing messages from the Storage queue by using the .NET library.</p>
</article>